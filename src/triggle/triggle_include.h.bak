#ifndef TRIGGLE_INCLUDE
#define TRIGGLE_INCLUDE

#define BRIDGE_SYSTEM_CHANNEL "system"  //define the system default channel name to suscribe the system event
#define BRIDGE_DEFAULT_EVENT 1  //define default delete event when the keys expires
#define BRIDGE_KEY_NOTIFY 1
#define BRIDGE_KEY_UNNOTIFY 0 
#include"dict.h"

#define BRIDGE_DEBUG 1 
struct redisClient;
struct redisObject;
struct dict;
enum BAIDU_BRIDGE_TRIGGLE{
	/*General keys operation*/
	DELETING_EVENT=203, //delete command triggle
    DELETED_EVENT,

	SETING_EVENT,
	SETED_EVENT,
	

	SETNXING_EVENT,
	SETNXED_EVENT,
	

	SETEXING_EVENT,
	SETEXED_EVENT,


	


	EXPIRED_EVENT,  //when expired the key from the database triggle
	/*String keys*/
	
	MSET_EVENT,
	SETEX_EVENT,
	SETBIT_EVENT,
	/*HASHES*/
	HDEL_EVENT,
	HSET_EVENT,
	/*LIST*/
	LPUSH_EVENT,
	LPOP_EVENT,
	LREM_EVENT,
	LSET_EVENT,
	RPUSH_EVENT,
	RPOP_EVENT,
	/*SET*/
	SADD_EVENT,
	SREM_EVENT,
	/*ZSET*/
	ZADD_EVENT,
	ZREM_EVENT,
	/*PUB,SUB*/
	PUBLISH_EVENT
};



typedef struct bridge_db_triggle_t{
    enum BAIDU_BRIDGE_TRIGGLE event;
	struct redisObject * lua_scripts;
	int dbid;
}bridge_db_triggle_t;

typedef struct bridge_db_externtion_t{
	dict * triggle_scipts;
	int bridge_event;
}bridge_db_externtion_t;


#define BRIDGE_DB_EXTENTIONS  struct bridge_db_externtion_t bridge_db;


void init_bridge_server();

void do_bridge_notify(void *db,void *keyobj);

void triggleCommand(struct redisClient *c); //redisClient *c


void triggleDelCommand(struct redisClient *c); //redisClient *c


void triggleListCommand(struct redisClient *c); //redisClient *c


void call_bridge_event(struct redisClient *c,int event_type);

void call_bridge_event_before(struct redisClient *c,int event_type);

void call_bridge_event_after(struct redisClient *c,int event_type);


#endif
